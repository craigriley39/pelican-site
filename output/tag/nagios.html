<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Blog About Nothin. - nagios</title>
        <link rel="stylesheet" href="http://justlearningdjango.com/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://justlearningdjango.com/">Blog About Nothin. </a></h1>
                <nav><ul>
    
                        <li><a href="http://justlearningdjango.com/pages/about.html">About</a></li>
    
                        <li><a href="http://justlearningdjango.com/">Welcome to My Site</a></li>
                    <li><a href="http://justlearningdjango.com/category/blog.html">Blog</a></li>
                    <li><a href="http://justlearningdjango.com/category/linux.html">Linux</a></li>
                    <li><a href="http://justlearningdjango.com/category/unix.html">Unix</a></li>
                </ul>
<form id="search" action="/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
		    <input id="searchbox" type="text" name="q" size="12" placeholder="Search">
		</form>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://justlearningdjango.com/draft-nagios-check_sshperf.html">Draft - Nagios Check_sshperf</a></h1>
<footer class="post-info">
        <span>Mon 15 February 2016</span>
<span>| tags: <a href="http://justlearningdjango.com/tag/perl.html">perl</a><a href="http://justlearningdjango.com/tag/nagios.html">nagios</a></span>
</footer><!-- /.post-info --><p>This is a program I used a lot back in the day. Nagios was checking against a bunch of linux and unix machines. The check_sshperf plugin would ssh into a box and run a series of comamnds over the ssh session and then dump them into a named pipe that Nagios would activily listen to. </p>
<p>Nagios opens a named pipe as part of its processing and uses this to recieve updates on passive checks. Pretty cool when you get to workign with it. </p>
<div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1">#   sshperf was hanging due to df -k stating stale NFS mounts. I think it would be best to stat only</span>
<span class="c1">#   local filesystems since those are all we are reporting on. changed for solaris df -k to df -lk </span>
<span class="c1">## </span>
<span class="c1">#    - 3/3/05 - craig</span>
<span class="c1">##</span>
<span class="c1">#   Updated 5/7/09 MAO to handle top upgrade - updated ParseTop() sub</span>
<span class="c1">#       Remove dependency on line position of the Memory string, and allow for new labels:</span>
<span class="c1">#       Old format:</span>
<span class="c1">#        Memory: 16G real, 3798M free, 13G swap in use, 12G swap free</span>
<span class="c1">#       New format:</span>
<span class="c1">#        Memory: 32G phys mem, 28G free mem, 32G total swap, 32G free swap</span>
<span class="c1">##</span>
<span class="c1">#############</span>





<span class="c1"># die(&quot;usage: sshperf -c &lt;configfile&gt;&quot;) if ($ARGV[0] != &quot;-c&quot;);</span>

<span class="nv">$CFGFILE</span> <span class="o">=</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$SNMPHOST</span> <span class="o">=</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

<span class="nv">$LOGFILE</span> <span class="o">=</span> <span class="s">&quot;/usr/local/nagios/var/sshperf.log&quot;</span><span class="p">;</span>
<span class="nv">$ECFFILE</span> <span class="o">=</span> <span class="s">&quot;/usr/local/nagios/var/rw/nagios.cmd&quot;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&quot;-d&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$DEBUG</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nv">$DEBUG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>


<span class="c1">## this program:</span>
<span class="c1"># reads a config file for thresholds, disks</span>
<span class="c1"># collects remote info via ssh</span>
<span class="c1"># parses all info into local variables</span>
<span class="c1"># submits SSHPERF ok if it can connect via ssh</span>
<span class="c1"># for each test in config file, submit passive event to nagios for threshold metrics</span>


<span class="c1">## todos:</span>
<span class="c1"># error check ARGs</span>
<span class="c1"># usage?</span>
<span class="c1">#</span>
<span class="c1"># collect interface bandwidth usage</span>
<span class="c1"># collect disk usage</span>


<span class="c1">#######################</span>


<span class="k">my</span> <span class="nv">$tests</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">ReadConfig</span><span class="p">();</span>


<span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">}))</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;user&quot;</span><span class="p">}))</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;key&quot;</span><span class="p">})))</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;missing complete connect statement\n&quot;</span><span class="p">);</span> <span class="p">}</span>


<span class="c1"># do the ssh</span>
<span class="nv">$SSHCOMMAND</span> <span class="o">=</span> <span class="s">&#39;/usr/bin/ssh&#39;</span><span class="p">;</span>


<span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /(.*):(\d+)/</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
    <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;port&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;linux-rh&quot;</span><span class="p">;</span> <span class="p">}</span>

<span class="k">my</span> <span class="nv">%commands</span><span class="p">;</span>
<span class="k">foreach</span> <span class="nv">$test</span> <span class="p">(</span><span class="nb">keys</span><span class="p">(</span><span class="nv">%tests</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1"># &amp;debug(&quot;saw test $test&quot;);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;load-5minave&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;uptime&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;uptime&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /^proc-exists-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;ps&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;ps&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;cpu-idlepct&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;vmstat&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;vmstat&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;mem-free&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;swap-free&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;mem-freepct&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;swap-freepct&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;top&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /^sar-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;sar&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;sar&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;sar&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;sar&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /snmp-oid-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /^snmp-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /disk-usedpct-(.*)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;df&quot;</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="s">&quot;df&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /local-check_smtp-(.*)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;mysql-status&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /^int-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}))</span> <span class="p">{</span> <span class="nv">$commands</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;cant do interfaces on non-linux: $test\n&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;unknown test: $test\n&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="c1"># XXX NEW</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nb">keys</span><span class="p">(</span><span class="nv">%commands</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1"># &amp;debug(&quot;registered command $_&quot;);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;uptime&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;uptime;&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;ps&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;ps -ef;&quot;</span><span class="p">;</span>
        <span class="p">}</span> 
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;vmstat&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;vmstat 2 2;&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;free&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;free;&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;top&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;\/usr\/local\/bin\/top -n 1;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;\/usr\/local\/bin\/top;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;df&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;df -P ;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;df -lk;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;df;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;sar&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;sar -Ah | sort -n -r -k3 | head -200;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;perf/collect_stats.pl;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;sar -Ah | sort -n -r -k3 | head -200;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /^local-check_smtp-(.*)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;bin/check_smtp -H $1 -w 5 -c 10 -t 10 -e &quot;</span> <span class="o">.</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">.</span> <span class="s">&quot;$e;&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /^snmp-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">,</span> <span class="nv">$misc</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$_</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SNMPHOST</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$h</span> <span class="o">=</span> <span class="nv">$SNMPHOST</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winprocessorload&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h .1.3.6.1.2.1.25.3.3.1.2.1;&quot;</span><span class="p">;</span> 
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winsystemnumusers&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h .1.3.6.1.2.1.25.1.5.0;&quot;</span><span class="p">;</span> 
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winsystemprocesses&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h .1.3.6.1.2.1.25.1.6.0;&quot;</span><span class="p">;</span> 
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;snmp-wintcpcurrestab&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h .1.3.6.1.2.1.6.9.0;&quot;</span><span class="p">;</span> 
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;snmp-ioscpu5min&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h .1.3.6.1.4.1.9.2.1.57.0;&quot;</span><span class="p">;</span> 
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;snmp-iosmem5minused&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h .1.3.6.1.4.1.9.9.48.1.1.1.5.1;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;snmp-iosmem5minfree&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h .1.3.6.1.4.1.9.9.48.1.1.1.6.1;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /snmp-oid-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;snmpget -v1 -c $comm -Oq $h $misc;&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">die</span><span class="p">(</span><span class="s">&quot;error: unknown snmp command: $_\n&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;mysql-status&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$_</span><span class="p">});</span>
        <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;/usr/bin/mysqladmin -u&quot;</span> <span class="o">.</span> <span class="nv">$user</span> <span class="o">.</span> <span class="s">&quot; -p&quot;</span> <span class="o">.</span> <span class="nv">$pass</span> <span class="o">.</span> <span class="s">&quot; status;&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /^int-(\S+)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sshcmd</span> <span class="o">=</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;echo \@\@\@\@;grep $1 /proc/net/dev;&quot;</span><span class="p">;</span> 
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;unknown command: $_&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="c1"># XXX NEW</span>
<span class="p">}</span>


<span class="nv">$sshline</span> <span class="o">=</span> <span class="nv">$SSHCOMMAND</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">};</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;port&quot;</span><span class="p">})</span> <span class="p">{</span> <span class="nv">$sshline</span> <span class="o">=</span> <span class="nv">$sshline</span> <span class="o">.</span> <span class="s">&quot; -p&quot;</span> <span class="o">.</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;port&quot;</span><span class="p">};</span> <span class="p">}</span>

<span class="nv">$sshline</span> <span class="o">=</span> <span class="nv">$sshline</span> <span class="o">.</span> <span class="s">&quot; -l&quot;</span> <span class="o">.</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;user&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; -i&quot;</span> <span class="o">.</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;key&quot;</span><span class="p">};</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;extra&quot;</span><span class="p">})</span> <span class="p">{</span>
    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Connect extra: &quot;</span> <span class="o">.</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;extra&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
    <span class="nv">$sshline</span> <span class="o">=</span> <span class="nv">$sshline</span> <span class="o">.</span>  <span class="s">&#39; &quot;&#39;</span> <span class="o">.</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;extra&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39; \&quot;&#39;</span> <span class="o">.</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&#39; \&quot; &quot;&#39;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$sshline</span> <span class="o">=</span> <span class="nv">$sshline</span> <span class="o">.</span>  <span class="s">&quot; \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$sshcmd</span> <span class="o">.</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ssh command line: &quot;</span> <span class="o">.</span> <span class="nv">$sshline</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="sb">`$sshline`</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">=~</span><span class="sr"> /\@\@\@\@/</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span><span class="p">;</span> <span class="c1"># 0 = ok, 1 = warn, 2 = crit</span>
    <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span> <span class="c1"># 0 = ok, 1 = warn, 2 = crit</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Couldn&#39;t connect to &quot;</span> <span class="o">.</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">my</span> <span class="p">(</span><span class="nv">@results</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\@\@\@\@/</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$res</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">(</span><span class="nv">@results</span><span class="p">);</span> <span class="c1">#the first result is trash</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nb">keys</span><span class="p">(</span><span class="nv">%commands</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">(</span><span class="nv">@results</span><span class="p">);</span>
    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Parsing for $_&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;uptime&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseUptime</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;ps&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParsePs</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;vmstat&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseVmstat</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;free&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseFree</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;df&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseDf</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;top&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseTop</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;sar&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseSar</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /local-check_smtp-(.*)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseLocalSmtp</span><span class="p">(</span><span class="nv">$res</span><span class="p">,</span> <span class="nv">$1</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /snmp-oid-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseSnmpOid</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /^snmp-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseSnmp</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span><span class="sr"> /^int-(\S+)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseInterface</span><span class="p">(</span><span class="nv">$1</span><span class="p">,</span> <span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&quot;mysql-status&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">ParseMysqlStatus</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Unknown command: $_&quot;</span><span class="p">);</span>
        <span class="nb">die</span><span class="p">(</span><span class="s">&quot;Unknown command: $_&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="c1"># XXX NEW</span>

<span class="p">}</span>


<span class="k">foreach</span> <span class="nv">$test</span> <span class="p">(</span><span class="nb">keys</span><span class="p">(</span><span class="nv">%tests</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1"># print &quot;doing result: $test \n&quot;;</span>
    <span class="c1"># next if ($warn == -1);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;load-5minave&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;load-5minave&quot;</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;load-5minave&quot;</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-load-5minave&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;5 minute load is &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;load-5minave&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;|load-5minave=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;load-5minave&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,load-15minave=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;load-15minave&quot;</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;cpu-idlepct&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-idlepct&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-idlepct&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-cpu-idlepct&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;CPU idle time is &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-idlepct&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;%|cpu-idlepct=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-idlepct&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,cpu-userpct=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-userpct&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,cpu-syspct=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-syspct&quot;</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;mem-free&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mem-free&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Free memory (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; / &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;) |mem-free=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,mem-total=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /proc-exists-(.*)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$numprocs</span><span class="p">,</span> <span class="nv">$procname</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>

        <span class="nv">@processes</span> <span class="o">=</span> <span class="nb">split</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;psout&quot;</span><span class="p">};</span>
        <span class="nv">$count</span> <span class="o">=</span> <span class="nb">grep</span> <span class="sr">/$procname/</span><span class="p">,</span> <span class="nv">@processes</span><span class="p">;</span>

        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;proc-exists: Found $count processes \n&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">&lt;</span> <span class="nv">$numprocs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-proc-exists-$procname&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Number of procs with name $procname : &quot;</span> <span class="o">.</span> <span class="nv">$count</span> <span class="p">);</span>  
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;swap-free&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-swap-free&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Free swap (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; / &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;) |swap-free=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,swap-total=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;mem-freepct&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-freepct&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-freepct&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mem-freepct&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Free memory &quot;</span> <span class="o">.</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&quot;%02.2f&quot;</span><span class="p">,</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-freepct&quot;</span><span class="p">})</span> <span class="o">.</span> <span class="s">&quot;% |mem-freepct=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-freepct&quot;</span><span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;swap-freepct&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-freepct&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-freepct&quot;</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-swap-freepct&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Free swap &quot;</span> <span class="o">.</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&quot;%02.2f&quot;</span><span class="p">,</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-freepct&quot;</span><span class="p">})</span> <span class="o">.</span> <span class="s">&quot;% |swap-freepct=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-freepct&quot;</span><span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /disk-usedpct-(.*)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-disk-usedpct-&quot;</span> <span class="o">.</span> <span class="nv">$1</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Space used on filesystem $1: &quot;</span> <span class="o">.</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&quot;%02.0f&quot;</span><span class="p">,</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">})</span> <span class="o">.</span> <span class="s">&quot;% |disk-usedpct-&quot;</span> <span class="o">.</span> <span class="nv">$1</span> <span class="o">.</span> <span class="s">&quot;=&quot;</span> <span class="o">.</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&quot;%02.0f&quot;</span><span class="p">,</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}));</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /local-check_smtp-(.*)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SMTP&quot;</span> <span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Invalid SMTP response&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SMTP&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Connection refused by host&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SMTP&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Unknown error&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SMTP&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Response time &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; seconds&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /^snmp-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winprocessorload&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Processor load: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |winprocessorload=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winsystemnumusers&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Number of users: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |winsystemnumusers=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winsystemprocesses&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Number of processes: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |winsystemprocesses=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-wintcpcurrestab&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Established TCP sessions: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |wintcpcurrestab=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-ioscpu5min&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;CPU util (5 min ave): &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |cpu5min=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-iosmem5minused&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&gt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Mem used (5 min ave): &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |mem5minused=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-iosmem5minfree&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;Mem free (5 min ave): &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |mem5minfree=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /snmp-oid-(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">$oidname</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
            <span class="k">my</span> <span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$comm</span><span class="p">,</span> <span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">,</span> <span class="nv">$oid</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$oidname</span> <span class="o">=~</span><span class="sr"> /\S+-outoctects/</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ans_tmp</span> <span class="o">=</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">};</span>
                <span class="nv">$ans_readable</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$ans_tmp</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot; k&quot;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ans_readable</span> <span class="o">=</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">};</span>
            <span class="p">}</span>
            <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="nv">$oidname</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="nv">$oidname</span> <span class="o">.</span> <span class="s">&quot;: &quot;</span> <span class="o">.</span> <span class="nv">$ans_readable</span> <span class="o">.</span> <span class="s">&quot; |&quot;</span> <span class="o">.</span> <span class="nv">$oidname</span> <span class="o">.</span> <span class="s">&quot;=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /^sar-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$warn</span><span class="p">,</span> <span class="nv">$crit</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$crit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">&lt;=</span> <span class="nv">$warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-&quot;</span> <span class="o">.</span> <span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;$test: $ans{$test} |&quot;</span> <span class="o">.</span> <span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;mysql-status&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="nv">$thread_w</span><span class="p">,</span> <span class="nv">$thread_c</span><span class="p">,</span> <span class="nv">$opent_w</span><span class="p">,</span> <span class="nv">$opent_c</span><span class="p">,</span> <span class="nv">$queries_w</span><span class="p">,</span> <span class="nv">$queries_c</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="nv">$tests</span><span class="p">{</span><span class="nv">$test</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-uptime&quot;</span><span class="p">}</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="nv">$string</span> <span class="o">=</span> <span class="s">&quot;Unable to check mysql status&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">}</span> <span class="o">&gt;</span> <span class="nv">$thread_c</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mysql-threads&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;MySQL thread count too high: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;|mysql-threads=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">});</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">}</span> <span class="o">&gt;</span> <span class="nv">$thread_w</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mysql-threads&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;MySQL thread count too high: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;|mysql-threads=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mysql-threads&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;MySQL thread count okay: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;|mysql-threads=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">});</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">}</span> <span class="o">&gt;</span> <span class="nv">$opent_c</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mysql-opentables&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;MySQL too many open tables: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |mysql-opentables=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">});</span>
            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">}</span> <span class="o">&gt;</span> <span class="nv">$opent_w</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$ret</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
                <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mysql-opentables&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;MySQL too many open tables: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |mysql-opentables=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-mysql-opentables&quot;</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;MySQL open tables okay: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; |mysql-opentables=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">});</span>
            <span class="p">}</span>
            <span class="nv">$string</span> <span class="o">=</span> <span class="s">&quot;Mysql uptime: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-uptime&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; seconds&quot;</span><span class="p">;</span>
            <span class="nv">$string</span> <span class="o">=</span> <span class="nv">$string</span> <span class="o">.</span> <span class="s">&quot;|mysql-questions=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-questions&quot;</span><span class="p">};</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-&quot;</span> <span class="o">.</span> <span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /^int-(\S+)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxbytes&quot;</span><span class="p">})</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxbytes&quot;</span><span class="p">}</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">&amp;</span><span class="n">SubmitPassive</span><span class="p">(</span><span class="s">&quot;SSHPERF-&quot;</span> <span class="o">.</span> <span class="nv">$test</span><span class="p">,</span> <span class="nv">$ret</span><span class="p">,</span> <span class="s">&quot;$test |&quot;</span> <span class="o">.</span> <span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxbytes=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxbytes&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxpkts=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxpkts&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxerrs=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-rxerrs&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-txbytes=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-txbytes&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-txpkts=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-txpkts&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-txerrs=&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span> <span class="o">.</span> <span class="s">&quot;-txerrs&quot;</span><span class="p">});</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;error: unknown test type: $test\n&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="c1"># XXX NEW</span>

<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;SSHPERF CRITICAL - &quot;</span> <span class="o">.</span> <span class="nv">$SSHPERFmessage</span><span class="p">);</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;SSHPERF CRITICAL - &quot;</span> <span class="o">.</span> <span class="nv">$SSHPERFmessage</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>  <span class="c1"># NOT USED TODAY</span>
    <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;SSHPERF WARNING - &quot;</span> <span class="o">.</span> <span class="nv">$SSHPERFmessage</span><span class="p">);</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;SSHPERF WARNING - &quot;</span> <span class="o">.</span> <span class="nv">$SSHPERFmessage</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>    <span class="c1"># ($SSHPERFstatus == 0)</span>
<span class="c1">#   &amp;Log(&quot;SSHPERF OKAY - &quot; . $SSHPERFmessage); print(&quot;SSHPERF OKAY - &quot; . $SSHPERFmessage . &quot;\n&quot;);</span>
    <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;SSHPERF OKAY - SSH to host confirmed\n&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">#######################</span>

<span class="k">sub </span><span class="nf">ParsePs</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@processes</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">@processes</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;psout&quot;</span><span class="p">}</span> <span class="o">.=</span> <span class="nv">$_</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseVmstat</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseVmstat: parsing: $lines[4]&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">((</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&quot;linux-rh&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+(\d+)\s+(\d+)\s+(\d+)/</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-userpct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-syspct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-idlepct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseVmstat: found user, sys, idle: $1, $2, $3&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">((</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&quot;linux-rh9&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+(\d+)\s+(\d+)\s+(\d+)\s+\d+/</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-userpct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-syspct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-idlepct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseVmstat: found user, sys, idle: $1, $2, $3&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">((</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+(\d+)\s+(\d+)\s+(\d+)/</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-userpct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-syspct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;cpu-idlepct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseVmstat: found user, sys, idle: $1, $2, $3&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Couldn&#39;t parse vmstat output.&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseSar</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="c1"># @lines = split(/\n/, $line);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /linux-rh/</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">#bull.atrust.com        600     1067843400      -       pgpgin/s        0.00</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">@tmp</span><span class="p">)</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="s">&quot;proc/s&quot;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+proc\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found proc/s: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-procs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+cswch\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found cswch/s: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-cswchs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+intr\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found intr/s: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-intrs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+pgpgin\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found pgpgin/s: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pgpgins&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+pgpgout\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found pgpgout/s: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pgpgouts&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+activepg\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found activepg: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-activepg&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+inadtypg\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found inadtypg: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-inadtypg&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+inaclnpg\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found inaclnpg: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-inaclnpg&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+inatarpg\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found inatarpg: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-inatarpg&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+pswpin\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found pswpins: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pswpins&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+pswpout\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found pswpouts: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pswpouts&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+tps\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found tps: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-tps&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+rtps\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found rtps: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-rtps&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+wtps\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found wtps: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-wtps&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+bread\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found breads: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-breads&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+bwrtn\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found bwrtns: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-bwrtns&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+frmpg\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found frmpgs: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-frmpgs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+shmpg\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found shmpgs: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-shmpgs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+bufpg\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found bufpgs: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-bufpgs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+campg\/s\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found campgs: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-campgs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+kbmemfree\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found kbmemfree: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-kbmemfree&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+kbmemused\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found kbmemused: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-kbmemused&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+%memused\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found pctmemused: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctmemused&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+kbmemshrd\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found kbmemused: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-kbmemused&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+kbbuffers\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found kbmemfree: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-kbmemfree&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+kbcached\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found kbmemused: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-kbmemused&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+kbswpfree\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found kbmemfree: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-kbmemfree&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+kbswpused\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found kbmemused: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-kbmemused&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+%swpused\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found pctswpused: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctswpused&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+dentunusd\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found dentunusd: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-dentunusd&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+file-sz\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found filesz: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-filesz&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+%file-sz\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found pctfilesz: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctfilesz&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+inode-sz\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found inodesz: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-inodesz&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1"># super-sz        0</span>
        <span class="c1"># %super-sz       0.00</span>
        <span class="c1"># dquot-sz        0</span>
        <span class="c1"># %dquot-sz       0.00</span>
        <span class="c1"># rtsig-sz        0</span>
        <span class="c1"># %rtsig-sz       0.00</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+totsck\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found totsck: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-totsck&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+tcpsck\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found tcpsck: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-tcpsck&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+udpsck\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found udpsck: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-udpsck&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+rawsck\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found rawsck: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-rawsck&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+ip-frag\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found ipfrag: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-ipfrag&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+runq-sz\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found runq-sz: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-runqsz&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /\S+\s+\S+\s+\S+\s+\S+\s+plist-sz\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found plist-sz: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-plistsz&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1"># ldavg-1   0.00</span>
        <span class="c1"># if ($line =~ /\S+\s+\S+\s+\S+\s+\S+\s+ldavg-5\s+(\S+)/) {</span>
            <span class="c1"># &amp;debug(&quot;ParseSar found ldavg-5: $1&quot;);</span>
            <span class="c1"># $ans{&quot;sar-ldavg5&quot;} = $1;</span>
        <span class="c1"># }</span>

    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /^solaris-/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /pctusr\s+pctsys\s+pctwio\s+pctidle\s+runqsz.*ovszallocfail\s+fiveminload\s+fifteenminload/</span><span class="p">)</span> <span class="p">{</span>

            <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctusr&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctsys&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctwio&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctidle&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-runqsz&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctrunocc&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-breads&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-lreads&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctrcache&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-bwrits&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-lwrits&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctwcache&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-preads&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pwrits&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pswpins&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pswpouts&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-bswins&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-bswots&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pswchs&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-scalls&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-sreads&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-swrits&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-forks&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-execs&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-rchars&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-wchars&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-igets&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-nameis&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-dirbks&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-rawchs&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-canchs&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-outchs&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-rcvins&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-xmtins&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-mdmins&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-procsz&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-procszmax&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-procszov&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-inodsz&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-inodszmax&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-inodszov&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-filesz&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-fileszmax&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-fileszov&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-locksz&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-lockszmax&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-msgs&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-semas&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-runqsz&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctrunocc&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pgouts&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-ppgouts&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pgfrees&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pgscans&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-pctufsipf&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-freemem&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-freeswap&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-smlmem&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-smlmemalloc&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-smlmemfail&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-lgmem&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-lgmemalloc&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-lgmemfail&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-ovszalloc&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-ovszallocfail&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-fiveminload&quot;</span><span class="p">},</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-fifteenminload&quot;</span><span class="p">})</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="nv">$lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar found solaris collect_stats.pl output. 5 min load: &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;sar-fiveminload&quot;</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSar couldnt parse collect_stats.pl output: $lines[1]&quot;</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Couldn&#39;t parse sar output.&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseSnmp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$res</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: parsing: $res&quot;</span><span class="p">);</span>


    <span class="k">if</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winprocessorload&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /hrProcessorLoad.1\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found processor load: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winsystemnumusers&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /hrSystemNumUsers.0\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found num users: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-winsystemprocesses&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /hrSystemProcesses.0\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found num procs: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-wintcpcurrestab&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /tcpCurrEstab.0\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found tcp established sessions: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-ioscpu5min&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /enterprises.9.2.1.57.0\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found 5 min cpu: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-iosmem5minused&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /enterprises.9.9.48.1.1.1.5.1\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found mem 5 min used: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: couldn&#39;t parse: $res&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$test</span> <span class="ow">eq</span> <span class="s">&quot;snmp-iosmem5minfree&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /enterprises.9.9.48.1.1.1.6.1\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found mem 5 min free: $1&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: couldn&#39;t parse: $res&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">die</span><span class="p">(</span><span class="s">&quot;Unknown snmp test&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseSnmpOid</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$test</span><span class="p">,</span> <span class="nv">$res</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: parsing: $res&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$test</span> <span class="o">=~</span><span class="sr"> /snmp-oid-(\S+)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$testname</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">=~</span><span class="sr"> /(.*)\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseSnmp: found $testname: $2&quot;</span><span class="p">);</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="nv">$test</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">die</span><span class="p">(</span><span class="s">&quot;snmp-oid failure: $test&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseInterface</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$int</span><span class="p">,</span> <span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseInterface: parsing: $line&quot;</span><span class="p">);</span>

<span class="c1"># Uptime: 247894  Threads: 29  Questions: 1238341  Slow queries: 3  Opens: 46  Flush tables: 1  Open tables: 39  Queries per second avg: 4.995</span>
    <span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
    <span class="p">(</span><span class="nv">$theint</span><span class="p">,</span> <span class="nv">$tmp</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="nv">$values</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-rxbytes&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$tmp</span><span class="p">;</span>
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-rxpkts&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$values</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-rxerrs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$values</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-txbytes&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$values</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-txpkts&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$values</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-txerrs&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$values</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseInterface: found tx/rx bytes (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-txbytes&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;/&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-rxbytes&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;), pkts (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-txpkts&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;/&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-rxpkts&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;), errs (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-txerrs&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;/&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;int-&quot;</span> <span class="o">.</span> <span class="nv">$theint</span> <span class="o">.</span> <span class="s">&quot;-rxerrs&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseMysqlStatus</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseMysqlStat: parsing: $line&quot;</span><span class="p">);</span>

<span class="c1"># Uptime: 247894  Threads: 29  Questions: 1238341  Slow queries: 3  Opens: 46  Flush tables: 1  Open tables: 39  Queries per second avg: 4.995</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /Uptime: (\d+)\s+Threads: (\d+)\s+Questions: (\d+)\s+Slow queries: (\d+)\s+Opens: (\d+)\s+Flush tables: (\d+)\s+Open tables: (\d+)\s+Queries per second avg: (\S+)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-uptime&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-threads&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-questions&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-slowqueries&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$4</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opens&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$5</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-flushtables&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$6</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-opentables&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$7</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-queries&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$8</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseMysqlStat: found threads, opentables, questions: $2, $7, $3&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Couldn&#39;t parse mysql status.&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseMysqlStat: unable to parse mysql status&quot;</span><span class="p">);</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mysql-uptime&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseUptime</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="c1"># &amp;debug(&quot;ParseUptime: parsing: $line&quot;);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /load average: \d+\.\d+, (\d+\.\d+), (\d+\.\d+)/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;load-5minave&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;load-15minave&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseUptime: found 5min load: $1&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Couldn&#39;t parse uptime output.&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseFree</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>

    <span class="c1"># &amp;debug(&quot;ParseFree: parsing&quot;);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^Mem:\s+(\d+)\s+\d+\s+(\d+)\s+\d+\s+\d+\s+\d+/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^Swap:\s+(\d+)\s+\d+\s+(\d+)/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseFree: found swap: (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; / &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseFree: found free mem: (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; / &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;ParseFree: parse swap error\n&quot;</span><span class="p">);</span> <span class="p">}</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-freepct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">/</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">});</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-freepct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">/</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Couldn&#39;t parse free output.&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseTop</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseTop: parsing: $lines[4]&quot;</span><span class="p">);</span>
    <span class="c1">#   Memory: 1024M real, 635M free, 230M swap in use, 922M swap free</span>

<span class="c1">#Updated this 5/7/09 MAO to handle top upgrade</span>
<span class="c1">#Remove dependency on line position of the Memory string, and allow for new labels:</span>
<span class="c1">#Old format:</span>
<span class="c1">#     Memory: 16G real, 3798M free, 13G swap in use, 12G swap free</span>
<span class="c1">#New format:</span>
<span class="c1">#     Memory: 32G phys mem, 28G free mem, 32G total swap, 32G free swap</span>

<span class="c1"># comment out the old:</span>
<span class="c1">#   if ($lines[4] =~ /^Memory:\s+(\S+)\s+real,\s+(\S+)\s+free,\s+(\S+)\s+swap in use,\s+(\S+)\s+swap free/) {</span>

<span class="c1"># add this:</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$_</span>  <span class="o">=~</span><span class="sr"> /^Memory:\s+(\S+)\s+(?:\S+\s*)+\,\s+(\S+)\s(?:\S+\s*)+\,\s+(\S+)\s+(?:\S+\s*)+\,\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>


            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
            <span class="k">my</span> <span class="nv">$swapused</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>

            <span class="c1"># Fix 6/17/04 BAW</span>
            <span class="c1"># Need to match GB also</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$4</span><span class="p">;</span>

            <span class="c1"># This is for 100% free swap (diff string)</span>
            <span class="c1">#       Memory: 1024M real, 635M free, 922M swap free</span>
        <span class="c1"># Comment out block below - MAO -     THIS IS DEFUNCT</span>
            <span class="c1">#} elsif ($lines[4] =~ /^Memory:\s+(\S+)\s+real,\s+(\S+)\s+free,\s+(\S+)\s+swap free/) {</span>
            <span class="c1">#        $ans{&quot;mem-total&quot;} = $1;</span>
            <span class="c1">#        $ans{&quot;mem-free&quot;} = $2;</span>
            <span class="c1">#        my $swapused = 0;</span>
            <span class="c1">#        $ans{&quot;swap-free&quot;} = $3;</span>
            <span class="nv">$parsed_top</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">;</span>
        <span class="p">}</span> 
<span class="c1">#else { </span>
    <span class="p">}</span>

    <span class="k">unless</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$parsed_top</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Couldn&#39;t parse top output.&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
        <span class="c1">#}</span>


    <span class="k">if</span> <span class="p">(</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">m/G$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">s/G$//</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">*=</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">s/M$//</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">m/G$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">s/G$//</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">*=</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">s/M$//</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$swapused</span> <span class="o">=~</span> <span class="sr">m/G$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$swapused</span> <span class="o">=~</span> <span class="sr">s/G$//</span><span class="p">;</span>
        <span class="nv">$swapused</span> <span class="o">*=</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$swapused</span> <span class="o">=~</span> <span class="sr">s/M$//</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">if</span> <span class="p">(</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">m/G$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">s/G$//</span><span class="p">;</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">*=</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">=~</span> <span class="sr">s/M$//</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$swapused</span> <span class="o">+</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">};</span>

    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span> 
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span> 
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span> 
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span> 

    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-freepct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">/</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">});</span>
    <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-freepct&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">/</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">});</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseFree: found swap: (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; / &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;swap-total&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseFree: found free mem: (&quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-free&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; / &quot;</span> <span class="o">.</span> <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;mem-total&quot;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">ParseDf</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseDf: parsing&quot;</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="nv">$l</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$l</span> <span class="o">=~</span><span class="sr"> /^Filesystem/</span><span class="p">);</span> 
        <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$l</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">);</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nv">$l</span> <span class="o">=~</span><span class="sr"> /^(\S+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\S+)\s+(\S+)$/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;disk-total-&quot;</span> <span class="o">.</span> <span class="nv">$6</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;disk-used-&quot;</span> <span class="o">.</span> <span class="nv">$6</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;disk-free-&quot;</span> <span class="o">.</span> <span class="nv">$6</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$4</span><span class="p">;</span>
            <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;disk-usedpct-&quot;</span> <span class="o">.</span> <span class="nv">$6</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$5</span><span class="p">;</span>
            <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseDf: found fs: $6 ($5)&quot;</span><span class="p">);</span> 
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
            <span class="c1">#if ($SSHPERFstatus &lt; 1) { $SSHPERFstatus = 1; $SSHPERFmessage = &quot;Couldn&#39;t parse df output.&quot;; &amp;Log($SSHPERFmessage);}</span>
            <span class="k">next</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">sub </span><span class="nf">ParseLocalSmtp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="nv">$host</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseLocalSmtp: parsing: &quot;</span> <span class="o">.</span> <span class="nv">$line</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /SMTP OK - (\d+) second response time/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;local-check_smtp-&quot;</span> <span class="o">.</span> <span class="nv">$host</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseLocalSmtp: OK: &quot;</span> <span class="o">.</span> <span class="nv">$1</span> <span class="o">.</span> <span class="s">&quot; second response time&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /Invalid SMTP response received from host/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;local-check_smtp-&quot;</span> <span class="o">.</span> <span class="nv">$host</span><span class="p">}</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseLocalSmtp: CRITICAL: invalid SMTP response&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Invalid SMTP response&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /Connection refused by host/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;local-check_smtp-&quot;</span> <span class="o">.</span> <span class="nv">$host</span><span class="p">}</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseLocalSmtp: CRITICAL: connection refused by host&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Connection refused by host&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$ans</span><span class="p">{</span><span class="s">&quot;local-check_smtp-&quot;</span> <span class="o">.</span> <span class="nv">$host</span><span class="p">}</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ParseLocalSmtp: CRITICAL: unknown error&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$SSHPERFstatus</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$SSHPERFstatus</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nv">$SSHPERFmessage</span> <span class="o">=</span> <span class="s">&quot;Unknown error&quot;</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="nv">$SSHPERFmessage</span><span class="p">);}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">sub </span><span class="nf">ReadConfig</span> <span class="p">{</span>
    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ReadConfig: Reading config from file: $CFGFILE&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">open</span><span class="p">(</span><span class="n">CFILE</span><span class="p">,</span> <span class="nv">$CFGFILE</span><span class="p">))</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Fatal: Couldn&#39;t open config file: $CFGFILE&quot;</span><span class="p">);</span> <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">my</span> <span class="nv">$l</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="sr">&lt;CFILE&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$l</span><span class="o">++</span><span class="p">;</span>
        <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="sr">/^#/</span><span class="p">);</span>
        <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="sr">/^$/</span><span class="p">);</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$val</span><span class="p">,</span> <span class="nv">@args</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;proc-exists&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span> <span class="o">.</span> <span class="s">&quot;-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;load-5minave&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;cpu-idlepct&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;mem-free&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;swap-free&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;mem-freepct&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;swap-freepct&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;disk-usedpct&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span> <span class="o">.</span> <span class="s">&quot;-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="o">=~</span><span class="sr"> /^sar-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;snmp-oid&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span> <span class="o">.</span> <span class="s">&quot;-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">5</span><span class="p">]}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="o">=~</span><span class="sr"> /^snmp-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;~&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="o">=~</span><span class="sr"> /^int-/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;local-check_smtp&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$a</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">(</span><span class="nv">@args</span><span class="p">);</span>
            <span class="nv">$b</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">(</span><span class="nv">@args</span><span class="p">);</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span> <span class="o">.</span> <span class="s">&quot;-&quot;</span> <span class="o">.</span> <span class="nv">$a</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;hostname&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$SNMPHOST</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;hostname&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;hostname&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$SNMPHOST</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;connect&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;user&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;key&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;connectextra&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;extra&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">@args</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;osversion&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;osversion&quot;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;debug&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$DEBUG</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$val</span> <span class="ow">eq</span> <span class="s">&quot;mysql-status&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tests</span><span class="p">{</span><span class="nv">$val</span><span class="p">}</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="nv">@args</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;config file error on line $l: unknown statement: $_\n&quot;</span><span class="p">);</span>
        <span class="p">}</span>
<span class="c1"># XXX NEW</span>
    <span class="p">}</span>

    <span class="nb">close</span><span class="p">(</span><span class="n">CFILE</span><span class="p">);</span>
    <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;ReadConfig: Done reading config from file: $CFGFILE&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">debug</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="nb">printf</span> <span class="n">stderr</span> <span class="s">&quot;debug: &quot;</span> <span class="o">.</span> <span class="nv">$message</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span> <span class="k">if</span> <span class="nv">$DEBUG</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">sub </span><span class="nf">Log</span> <span class="p">{</span>
  <span class="k">my</span><span class="p">(</span><span class="nv">$entry</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

  <span class="c1"># if (open(LOGFILE, &quot;&gt;&gt;$LOGFILE&quot;)) {</span>

<span class="c1">#     (@ctime) = localtime(time);</span>
<span class="c1">#     printf LOGFILE (&quot;%02d/%02d/%02d %02d:%02d\t$entry\n&quot;, $ctime[4]+1, $ctime[3], $ctime[5]+1900, $ctime[2], $ctime[1]);</span>
<span class="c1">#     close LOGFILE;</span>
 <span class="c1">#  }</span>
  <span class="o">&amp;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Log: $entry\n&quot;</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">sub </span><span class="nf">SubmitPassive</span> <span class="p">{</span>
  <span class="k">my</span><span class="p">(</span><span class="nv">$description</span><span class="p">,</span> <span class="nv">$returncode</span><span class="p">,</span> <span class="nv">$text</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
  <span class="k">my</span> <span class="nv">$h</span><span class="p">;</span>

  <span class="nb">open</span><span class="p">(</span><span class="n">ECF</span><span class="p">,</span> <span class="s">&quot;&gt;&gt;$ECFFILE&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="nb">die</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t open $ECFFILE: $!\n&quot;</span><span class="p">);</span>

  <span class="c1"># $returncode = $SSHPERFstatus;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$ret</span> <span class="o">=</span> <span class="s">&quot;OK&quot;</span><span class="p">;</span> 
  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$returncode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$ret</span> <span class="o">=</span> <span class="s">&quot;WARNING&quot;</span><span class="p">;</span> 
  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$returncode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$ret</span> <span class="o">=</span> <span class="s">&quot;CRITICAL&quot;</span><span class="p">;</span> 
  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$returncode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$ret</span> <span class="o">=</span> <span class="s">&quot;UNKNOWN&quot;</span><span class="p">;</span> 
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nv">$ret</span> <span class="o">=</span> <span class="s">&quot;UNKNOWN&quot;</span><span class="p">;</span> <span class="p">}</span> 

 <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;hostname&quot;</span><span class="p">})</span> <span class="p">{</span>
    <span class="nv">$h</span> <span class="o">=</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;hostname&quot;</span><span class="p">};</span>
 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$h</span> <span class="o">=</span> <span class="nv">$connection</span><span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">};</span>
 <span class="p">}</span>

<span class="k">print</span> <span class="n">ECF</span> <span class="p">(</span><span class="s">&quot;[&quot;</span> <span class="o">.</span> <span class="nb">time</span> <span class="o">.</span> <span class="s">&quot;] PROCESS_SERVICE_CHECK_RESULT;&quot;</span> <span class="o">.</span> <span class="nv">$h</span> <span class="o">.</span> <span class="s">&quot;;&quot;</span> <span class="o">.</span> <span class="nv">$description</span> <span class="o">.</span> <span class="s">&quot;;$returncode;$description $ret - &quot;</span> <span class="o">.</span> <span class="nv">$text</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
  <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;[&quot;</span> <span class="o">.</span> <span class="nb">time</span> <span class="o">.</span> <span class="s">&quot;] PROCESS_SERVICE_CHECK_RESULT;&quot;</span> <span class="o">.</span> <span class="nv">$h</span> <span class="o">.</span> <span class="s">&quot;;&quot;</span> <span class="o">.</span> <span class="nv">$description</span> <span class="o">.</span> <span class="s">&quot;;$returncode;$description $ret - &quot;</span> <span class="o">.</span> <span class="nv">$text</span> <span class="p">);</span>

<span class="k">print</span>  <span class="p">(</span><span class="s">&quot;[&quot;</span> <span class="o">.</span> <span class="nb">time</span> <span class="o">.</span> <span class="s">&quot;] PROCESS_SERVICE_CHECK_RESULT;&quot;</span> <span class="o">.</span> <span class="nv">$h</span> <span class="o">.</span> <span class="s">&quot;;&quot;</span> <span class="o">.</span> <span class="nv">$description</span> <span class="o">.</span> <span class="s">&quot;;$returncode;$description $ret - &quot;</span> <span class="o">.</span> <span class="nv">$text</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
  <span class="o">&amp;</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;[&quot;</span> <span class="o">.</span> <span class="nb">time</span> <span class="o">.</span> <span class="s">&quot;] PROCESS_SERVICE_CHECK_RESULT;&quot;</span> <span class="o">.</span> <span class="nv">$h</span> <span class="o">.</span> <span class="s">&quot;;&quot;</span> <span class="o">.</span> <span class="nv">$description</span> <span class="o">.</span> <span class="s">&quot;;$returncode;$description $ret - &quot;</span> <span class="o">.</span> <span class="nv">$text</span> <span class="p">);</span>

  <span class="nb">close</span> <span class="n">ECF</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://github.com/craigriley39">Github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>